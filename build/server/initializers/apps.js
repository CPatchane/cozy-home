// Generated by CoffeeScript 1.9.3
var Application, createApp, fs, path;

path = require('path');

fs = require('fs');

Application = require('../models/application');

module.exports = function(callback) {
  return Application.destroyAll(function() {
    return createApp('contacts', 9114, function() {
      return createApp('emails', 9125, function() {
        return callback();
      });
    });
  });
};

createApp = function(name, port, callback) {
  var data;
  data = {
    name: "" + name,
    displayName: "" + name,
    description: name + " description",
    slug: "" + name,
    state: "installed",
    isStoppable: false,
    icon: "img/apps/" + name + ".svg",
    git: "https://github.com/cozy/cozy-" + name + ".git",
    version: "2.1.7",
    comment: "official application",
    needsUpdate: false,
    favorite: false,
    iconType: "svg",
    port: port
  };
  return Application.create(data, function(err, app) {
    var iconPath;
    iconPath = path.join(__dirname, '..', '..', 'client', 'public', 'img', 'apps', name + ".svg");
    return app.attachFile(iconPath, {
      name: 'icon.svg'
    }, function(err) {
      return callback();
    });
  });
};
